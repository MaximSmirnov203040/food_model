# Система Рекомендации Рецептов

Комплексная система рекомендации рецептов, которая предоставляет персонализированные предложения на основе предпочтений пользователя, диетических ограничений и целей питания.

## Возможности

- **Персонализированные рекомендации**: Подбор рецептов на основе предпочтений и диетических ограничений
- **Диетические ограничения**: Поддержка различных диетических предпочтений (вегетарианство, веганство, кето и др.)
- **Отслеживание аллергенов**: Комплексное определение и фильтрация аллергенов
- **Анализ питания**: Подробная информация о питательной ценности и предупреждения о пищевых флагах
- **Предпочтения кухни**: Персонализированные предпочтения кухни и рекомендации
- **Полное тестовое покрытие**: Тщательное тестирование всех основных компонентов
- **CI/CD пайплайн**: Автоматизированное тестирование и проверка качества кода

## Структура проекта

```
food_model/
├── app/
│   ├── api/
│   │   └── v1/
│   │       ├── endpoints/
│   │       └── router.py
│   ├── core/
│   │   ├── config.py
│   │   └── security.py
│   ├── data/
│   │   └── ingredient_loader.py
│   ├── models/
│   │   └── models.py
│   ├── schemas/
│   │   └── schemas.py
│   └── services/
│       └── recommendation.py
├── tests/
│   ├── api/
│   ├── data/
│   ├── integration/
│   └── training/
├── scripts/
│   └── training/
├── alembic/
├── alembic.ini
├── requirements.txt
├── requirements-dev.txt
├── pytest.ini
├── .github/
│   └── workflows/
│       └── test.yml
└── .codecov.yml
```

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/food_model.git
cd food_model
```

2. Создайте и активируйте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # Для Windows: venv\Scripts\activate
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Настройте переменные окружения:
```bash
cp .env.example .env
# Отредактируйте .env с вашими настройками
```

5. Инициализируйте базу данных:
```bash
alembic upgrade head
```

## Тестирование

Проект включает полное тестовое покрытие всех основных компонентов:

### Модульные тесты
Расположены в директории `tests/`, охватывают:
- Функциональность загрузки ингредиентов
- Предварительную обработку данных
- Обучение модели
- API эндпоинты
- Вспомогательные функции

### Запуск тестов

1. Установите зависимости для тестирования:
```bash
pip install -r requirements-dev.txt
```

2. Запустите все тесты:
```bash
pytest
```

3. Запустите определенные категории тестов:
```bash
# Запуск только модульных тестов
pytest tests/unit

# Запуск только интеграционных тестов
pytest tests/integration

# Запуск с отчетом о покрытии
pytest --cov=app --cov-report=term-missing
```

### Категории тестов

1. **Тесты загрузки ингредиентов** (`tests/data/test_ingredient_loader.py`)
   - Тесты интеграции с API
   - Тесты парсинга данных
   - Тесты обработки ошибок
   - Тесты ограничения частоты запросов
   - Тесты обнаружения дубликатов

2. **Тесты обучения модели** (`tests/training/`)
   - Тесты подготовки данных
   - Тесты архитектуры модели
   - Тесты процесса обучения
   - Тесты валидации

3. **API тесты** (`tests/api/`)
   - Тесты эндпоинтов
   - Тесты аутентификации
   - Тесты валидации запросов
   - Тесты формата ответов

## CI/CD пайплайн

Проект использует GitHub Actions для непрерывной интеграции и Codecov для отслеживания покрытия кода.

### Автоматизированное тестирование

Тесты автоматически запускаются при:
- Каждом push в ветку main
- Каждом pull request

CI пайплайн включает:
- Настройку окружения Python
- Контейнер сервиса PostgreSQL
- Установку зависимостей
- Выполнение тестов с покрытием
- Отчеты о покрытии кода

### Покрытие кода

- Минимальное требование покрытия: 80%
- Генерируются отчеты о покрытии для:
  - Общего покрытия проекта
  - Покрытия изменений в PR
- Покрытие отслеживается и отчитывается через Codecov

### Конфигурация CI/CD

1. **GitHub Actions** (`.github/workflows/test.yml`):
   - Запуск на Ubuntu latest
   - Настройка Python 3.9
   - Конфигурация сервиса PostgreSQL
   - Установка зависимостей
   - Запуск тестов с покрытием
   - Загрузка отчетов о покрытии

2. **Codecov** (`.codecov.yml`):
   - Настройка порогов покрытия
   - Настройка правил отчетности
   - Определение игнорируемых файлов и директорий

### Настройка CI/CD

1. Создайте репозиторий на GitHub
2. Подключите Codecov:
   - Зарегистрируйтесь на codecov.io
   - Добавьте ваш репозиторий
   - Получите токен Codecov
3. Добавьте токен Codecov в секреты GitHub репозитория:
   - Перейдите в настройки репозитория
   - Добавьте секрет: `CODECOV_TOKEN`

## Использование API

### Предпочтения пользователя

Обновление предпочтений пользователя:
```bash
curl -X PUT "http://localhost:8000/api/v1/users/me/preferences" \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{
       "dietary_restrictions": ["vegetarian"],
       "favorite_cuisines": ["italian", "japanese"],
       "allergies": ["nuts"],
       "food_flags": ["high_sodium"]
     }'
```

### Рекомендации рецептов

Получение персонализированных рекомендаций:
```bash
curl "http://localhost:8000/api/v1/recommendations" \
     -H "Authorization: Bearer YOUR_TOKEN"
```

### Детали рецепта

Получение информации о рецепте с пищевыми флагами:
```bash
curl "http://localhost:8000/api/v1/recipes/1" \
     -H "Authorization: Bearer YOUR_TOKEN"
```

## Участие в разработке

1. Сделайте форк репозитория
2. Создайте ветку для новой функции
3. Зафиксируйте изменения
4. Отправьте изменения в ветку
5. Создайте Pull Request

## Лицензия

Этот проект распространяется под лицензией MIT - подробности в файле LICENSE. 